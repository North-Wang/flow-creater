# 自動化劇本編輯器 - 新版設計

## 概述

這是一個全新的自動化劇本編輯器，採用現代化的設計理念和技術架構，提供更直觀、更強大的劇本編輯體驗。

## 主要功能

### 🎯 核心功能

- **視覺化流程設計**: 基於 Vue Flow 的拖拽式流程圖編輯器
- **節點類型系統**: 支持觸發事件、響應事件、動作節點、條件節點等多種類型
- **實時驗證**: 完整的腳本驗證系統，確保劇本的正確性
- **版本控制**: 內建的撤銷/重做功能，支持操作歷史記錄

### 🎨 用戶界面

- **三欄式布局**: 左側工具欄、中央畫布、右側屬性面板
- **響應式設計**: 適配不同屏幕尺寸
- **現代化 UI**: 基於 Tailwind CSS 的美觀界面
- **直觀操作**: 拖拽添加節點，點擊連接，雙擊編輯

### 🔧 技術特性

- **狀態管理**: 使用 Pinia 進行集中式狀態管理
- **組件化架構**: 高度模塊化的組件設計
- **類型安全**: 完整的 TypeScript 支持
- **可擴展性**: 支持動態註冊新的節點類型

## 架構設計

### 組件結構

```
src/
├── views/
│   └── ScriptEditorPage.vue          # 主編輯器頁面
├── components/
│   └── ScriptEditor/
│       ├── ScriptCanvas.vue          # 畫布組件
│       ├── NodeProperties.vue        # 節點屬性編輯器
│       ├── Nodes/                    # 節點組件
│       │   ├── TriggerEventNode.vue
│       │   ├── ResponseEventNode.vue
│       │   ├── ActionNode.vue
│       │   ├── ConditionNode.vue
│       │   └── TemplateNode.vue
│       └── Edges/
│           └── StepEdge.vue          # 連接線組件
├── stores/
│   └── scriptStore.js               # 腳本狀態管理
├── composables/
│   └── useNodeRegistry.js           # 節點註冊系統
└── utils/
    └── scriptValidator.js           # 腳本驗證工具
```

### 數據模型

- **ExtensibleScript**: 可擴展的腳本數據結構
- **ExtensibleTask**: 可擴展的任務數據結構
- **NodeType**: 節點類型定義
- **Connection**: 節點連接關係

## 使用方法

### 1. 訪問編輯器

點擊首頁的"新版編輯器"按鈕，或直接訪問 `/script-editor` 路由。

### 2. 添加節點

- 從左側工具欄拖拽節點到畫布
- 或使用畫布頂部的快速添加按鈕

### 3. 連接節點

- 點擊節點的連接點並拖拽到目標節點
- 系統會自動驗證連接的有效性

### 4. 編輯節點屬性

- 選中節點後，在右側屬性面板進行編輯
- 支持事件類型、排程、模板等配置

### 5. 保存劇本

- 點擊頂部的"儲存"按鈕
- 系統會自動驗證劇本的正確性

## 節點類型

### 觸發事件 (Trigger Events)

- **註冊觸發**: 用戶註冊時觸發
- **購買觸發**: 用戶購買商品時觸發
- **購物車放棄觸發**: 用戶放棄購物車時觸發

### 響應事件 (Response Events)

- **郵件響應**: 發送郵件響應
- **簡訊響應**: 發送簡訊響應

### 動作節點 (Action Nodes)

- **延遲動作**: 延遲執行下一個動作

### 條件節點 (Condition Nodes)

- **用戶分群條件**: 根據用戶分群進行條件判斷

## 驗證規則

### 基本驗證

- 腳本名稱不能為空
- 至少需要一個觸發事件
- 所有任務 ID 必須唯一

### 連接驗證

- 檢查節點連接的有效性
- 防止循環引用
- 驗證引用節點的存在性

### 數據驗證

- 郵箱格式驗證
- 時間格式驗證
- Cron 表達式格式驗證

## 擴展開發

### 添加新節點類型

1. 在 `useNodeRegistry.js` 中定義新的節點類型
2. 創建對應的節點組件
3. 在 `ScriptCanvas.vue` 中註冊新組件

### 自定義驗證規則

1. 在 `scriptValidator.js` 中添加新的驗證方法
2. 在對應的驗證流程中調用

### 擴展數據模型

1. 修改 `extensibleSchema.ts` 中的類型定義
2. 更新相關的組件和驗證邏輯

## 技術棧

- **前端框架**: Vue 3 + Composition API
- **狀態管理**: Pinia
- **路由**: Vue Router 4
- **UI 框架**: Tailwind CSS
- **流程圖**: Vue Flow
- **驗證**: 自定義驗證器
- **構建工具**: Vite

## 未來規劃

### 短期目標

- [ ] 添加更多節點類型
- [ ] 實現模板庫功能
- [ ] 添加導入/導出功能
- [ ] 優化性能

### 長期目標

- [ ] 支持協作編輯
- [ ] 添加版本管理
- [ ] 實現實時預覽
- [ ] 支持插件系統

## 貢獻指南

1. Fork 項目
2. 創建功能分支
3. 提交更改
4. 發起 Pull Request

## 許可證

MIT License
